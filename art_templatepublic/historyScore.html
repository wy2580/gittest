<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="styles/mobile-reset.css">
    <link rel="stylesheet" href="styles/swiper.min.css">
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/index.css">
    <script type="text/javascript" src="js/base.js"></script>
</head>
<body>
    <!-- head部分开始 -->
    <div class="zsaichuanxiangjie wapper hidden zbaomingxitong">
        <a href="javascript:;" class="back"></a>
        <h3 class="ztitle zhuanghaibei"></h3>
        <a href="gerenyemian.html" class="shipinsuoluetu hidden" id="cdbmzhuyetouxiang">
            <img src="images/weidenglu.png" alt="" class="headsuoluetu">
        </a>
    </div>
    <div class="matchScoreCon wapper hidden contentTop">
        <div id="shipTypeSolid" class="hidden">
            <ul class="shipTypeSolidUl hidden" id="shipTypeSolidUl">
                <!-- <li class="shipTypeSolidLi f_left hidden">
                    <span class="shipTypeName f_left">博纳多 40.7</span>
                </li>
                <li class="shipTypeSolidLi f_left hidden">
                    <span class="shipTypeName f_left">Farest 28R</span>
                </li> -->
            </ul>
        </div>
        <div class="shipTypeScorekuang wapper hidden" id="shipTypeScorekuang">
            <!-- <div class="shipTypeScore hidden">
                <ul class="shipTypeScoreShip f_left hidden">
                    <li class="shipTypeScoreShipTitle hidden">
                        <span class="shipRank f_left">排名</span>
                        <span class="scoreMatchShipName f_left">船队名</span>
                        <span class="allScore f_left">总分</span>
                        <span class="chengji f_right">成绩</span>
                    </li>
                </ul>
                <div id="shipScoreView" class="hidden f_right">
                    <ul class="shipScoreViewUl hidden">
                        <li class="shipScoreViewLi f_left">
                            <ul class="singleScoreUl hidden">
                                <li class="singleScoreli f_left">R1</li>
                                <li class="singleScoreli f_left">8</li>
                                <li class="singleScoreli f_left">8</li>
                                <li class="singleScoreli f_left">8</li>
                                <li class="singleScoreli f_left">8</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div> -->
        </div>
        <div class="safe hidden">
            <p class="scoreDescription">2016中国杯帆船赛伯纳多40.7组别共25条船参赛，10.27日一场比赛，10月28日3场比赛，10月29日3场比赛，10月30日1场比赛，每轮比赛按冲线顺序数计分为R1、R2、R3、R4、R5、R6、R7、R8、R9，各轮成绩之和为总分，总分减去最差一轮计分为“成绩”，按成绩分数，从小往大排序为最终成绩排名。</p>
        </div>
    </div>
    <!-- 合作伙伴部分开始 -->
    <div class="chuanduijieshao hidden">
        <div class="sychuansai wapper hidden bisaicj">
            <h2 class="syh">合作伙伴</h2>
        </div>
        <div class="hezuolianjie hidden">
            <img src="images/sinanBai_cooperate.png" alt="" class="cooperateLogo">
        </div>
    </div>
    <!-- 合作伙伴部分结束 -->
    <!-- 支持媒体部分开始 -->
    <div class="chuanduijieshao hidden">
        <div class="sychuansai wapper hidden bisaicj">
            <h2 class="syh">支持媒体</h2>
            <!-- <a href="#" class="morea"></a> -->
        </div>
        <div class="hezuolianjie hidden">
            <img src="images/sinanBei_organizer.png" alt="" class="organizerLogo">
        </div>
    </div>
    <!-- 支持媒体部分结束 -->
    <!-- 承办单位部分开始 -->
    <div class="wapper hidden chengbandanwei">
        <div class="safe hidden" id="organizerSafe">
            <div class="zuweihui">
                <p class="chengbandanweip">
                    司南杯大帆船赛组委会
                </p>
                <p class="chengbandanweip">三亚司南航海推广发展有限公司 </p>
                <p class="chengbandanweip">地址：海南省三亚市榆亚大道2号鸿洲时代海岸2号楼2601室 </p>
                <p class="chengbandanweip">电话：0898-88601866 </p>
            </div>
            <div class="lianxifangshi">
                <p class="chengbandanweip">报名咨询：baoming2016@sinanregatta.com </p>
                <p class="chengbandanweip">媒体联络：media@sinanregatta.com </p>
            </div>
            <div class="zhidaodanwei">
                <p class="chengbandanweip">指导单位：中国帆船帆板运动协会、海南省文化广电出版体育厅</p>
                <p class="chengbandanweip">主办单位：三亚市人民政府、三沙市人民政府 </p>
                <p class="chengbandanweip">支持单位：海南省海防与口岸办公室、交通部南海救助局三亚基地 </p>
                <p class="chengbandanweip">承办单位：三亚市文化广电出版体育局、三亚司南航海推广发展有限公司 </p>
                <p class="chengbandanweip">协办单位：三亚亚龙湾游艇会 </p>
            </div>
        </div>
    </div>
    <!-- 承办单位部分结束 -->
    <!-- logo部分开始 -->
    <div class="wapper hidden logo">
        <img src="images/cnsalogo.png" alt="" class="logoimgCnsa">
        <img src="images/logo.png" alt="" class="logoimg">
    </div>
    <!-- logo部分结束 -->
    <!-- footer部分开始 -->
    <div class="footer wapper">
        <p class="footp">CNSA 中国帆船赛</p>
    </div>
    <!-- footer部分结束 -->
</body>

<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/fastclick.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/lib.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/lib.js"></script>
<script type="text/javascript" src="js/iscroll.js"></script>
<script type="text/javascript">
var myScroll;
var sailingId=$.cookie('levelSailingId');
$(".ztitle").html(saveMatchName()); 
var height1=$(window).height();
var height2=$(".zsaichuanxiangjie").height()*2;
// var height3=height1-height2;
// $(".matchScoreCon").css({'min-height':height3});

$(".shipTypeName").eq(0).css({'color':"#00b1ff",'border-bottom':".04rem solid  #00b1ff"});
$(".shipTypeName").each(function(){ 
    var item=$(this);
    $(this).click(function(){
        $(".shipTypeName").css({'color':"#fff",'border':"none"}); 
        item.css({'color':"#00b1ff",'border-bottom':".04rem solid  #00b1ff"});
    })
})


newMatchId=$.cookie('new_MatchId');
//请求数据
function getSoreAllData(){
    return getData({
        url: "/match/getInfo",
        data:{"matchId":newMatchId},
    });
}
//渲染页面数据
//获取赛事级别数据
function getShipLevel(item){
    return $([
        '<li class="shipTypeSolidLi f_left hidden" id="sailingId'+item['sailingId']+'" sailingId="'+item['sailingId']+'">',
        '    <span class="shipTypeName f_left">'+item['name']+'</span>',
        '</li>',
    ].join(''));
}
//获取每个级别下的船队信息和总成绩的框
function shipScoreKuang(item){
    return $([
        '<div class="shipTypeScore hidden" id="shipTypeScore'+item['sailingId']+'">',
        '    <ul class="shipTypeScoreShip f_left hidden">',
        '    </ul>',
        '    <div id="shipScoreView'+item['sailingId']+'" class="shipScoreView hidden f_right">',
        '         <ul class="shipScoreViewUl hidden" id="shipScoreViewUl'+item['sailingId']+'">',
        '         </ul>',
        '    </div>',
        '</div>',
    ].join(''));
}
//获取每个级别下的船队总信息
function getALLShipDetail(item,i){
    var str='';
    str+='<li class="shipTypeScoreShipTitle hidden" id="teamId'+item['teamId']+'">';
    str+='    <span class="shipRank f_left">'+item['rank']+'</span>';
    str+='    <span class="scoreMatchShipName f_left">'+item['name']+'/<span class="shipNum">'+i+'</span>号</span>';
    str+='    <span class="allScore f_left">'+item['score']+'</span>';
    str+='   <span class="chengji f_right">'+item['totalScore']+'</span>';
    str+='</li>';
    return str;
}
function getALLShipDetailFirst(){
    var str='';
    str+='<li class="shipTypeScoreShipTitle hidden">';
    str+='    <span class="shipRank f_left">排名</span>';
    str+='    <span class="scoreMatchShipName f_left">船队名</span>';
    str+='    <span class="allScore f_left">总分</span>';
    str+='    <span class="chengji f_right">成绩</span>';
    str+='</li>';
    return str;
}
//获取船队的每轮成绩的标题轮次
function getSingleScoreDetailFirst(item){
    var str='';              
    str+='<li class="shipScoreViewLi f_left" id="roundId'+item['roundId']+'">';
    str+='    <span class="lunciSpan f_left">'+item['round']+'</span>';
    str+='</li>';
    return str;
}
//获取船队的每轮成绩
function getSingleShipScore(item){
    var str=''; 
    if(item['roundId']){
        str+='<div class="shipScoreViewLi f_left" id="roundId'+item['roundId']+'">';
        str+='    <span class="lunciSpan f_left" id="roundSpanId'+item['roundId']+'">'+item['round']+'</span>';
        str+='</div>';
    }             
    return str;
}
//获取每个船队下每个轮次的成绩
function getshipAllScore(item){
    var str='';
    str+='<li class="shipScoreViewLi f_left" id="roundId'+item['roundId']+'">';
    str+='    <ul class="singleScoreUl hidden">';
    str+='       <li class="singleScoreli f_left">'+item['score']+'</li>';
    str+='   </ul>';
    str+='</li>';
    return str;
}
//每个船队轮次成绩的框
function trunTitle(item){
    var str='';
    str+='<li class="singleScoreli f_left" id="roundId'+item['roundId']+'">'+item['roundName']+'</li>';
}
//赛船级别点击样式
function getSocrePage(){
    var dataAll=getSoreAllData();
    if(!dataAll){
        alert("网络请求错误");
        return;
    }
    var matchRanking=dataAll['matchRanking'];
    if(matchRanking==0){
        $("#shipTypeSolid").hide();
        return;
    }
    var firstSaillingId = '';
    for(var i in matchRanking){
        //DIV -shipTypeSolidUl
        itemLevel=matchRanking[i];

        $("#shipTypeSolidUl").append(getShipLevel(itemLevel));
        if(!firstSaillingId){
            firstSaillingId = itemLevel['sailingId']
        }
        if($("#shipTypeScore"+itemLevel['sailingId']).length == 0){
            $('#shipTypeScorekuang').append(shipScoreKuang(itemLevel));
            
        } 
        var len=$("#shipTypeScorekuang").children().length;
        //渲染赛船的信息和总成绩
        var itemRank=itemLevel['rank'];
        // var itemSocore=$("#shipTypeScorekuang").children(i);
        var itemSocore=$(".shipTypeScore").eq(i).find("ul.shipTypeScoreShip");
        var itemHtml=$(".shipTypeScore").eq(i).find("ul.shipScoreViewUl");
        //获取标题轮次
        var matchSailing=dataAll['matchSailing'];
        var  matchSailingRound=matchSailing[i]['matchSailingRound'];

        for(var q in matchSailingRound){
            var item=matchSailingRound[q];  
            if($("#roundId"+item['roundId']).length<=0){
                itemHtml.append(getSingleScoreDetailFirst(item));
            }
        }
        var len=itemHtml.find("li.shipScoreViewLi");
        var wid2=1*(len.length)+"rem";
        itemHtml.width(wid2);
        // 渲染船队信息
        for(var j in itemRank){
            var item=itemRank[j];
            var x=j;
            if($("#teamId"+item['teamId']).length<=0){
                if(x==0){
                itemSocore.prepend(getALLShipDetailFirst());
                }
                x=parseInt(j)+1;
                itemSocore.append(getALLShipDetail(item,x));
            }
            //渲染船队轮次成绩
            var itemRoundRank=item['roundRank'];
            for(var g in matchSailingRound){
//                console.log(i+'-'+g+'-');
                var flag= false;
                for(var k in itemRoundRank){
                    var itemi=itemRoundRank[k];
                    if( matchSailingRound[g]['roundId'] == itemi['roundId']){
                      
                       flag = true;
                       itemHtml.find("li#roundId"+itemi['roundId']).append('<span class="lunciSpan f_left" id="roundSpanId'+itemi['roundId']+'">'+itemi['score']+'</span>');
                   }
                }
                if(!flag){
//                    console.log(i+'-'+g+'-'+k+'+');
                    itemHtml.find("li#roundId"+matchSailingRound[g]['roundId']).append('<span class="lunciSpan f_left" id="roundSpanId-">'+'-'+'</span>');
                }
            }
        } 
        var myScroll1 = new IScroll('#shipTypeSolid', { scrollX: true, scrollY: false, mouseWheel: false,preventDefault: true ,eventPassthrough: true }); 
        new IScroll("#shipScoreView"+itemLevel['sailingId'], { scrollX: true, scrollY: false,preventDefault: false , mouseWheel: false ,eventPassthrough: true});
        
    }
    //动态渲染数据后改变父元素宽高
    var wid1=2.2*($(".shipTypeSolidLi").length)+"rem";
    $('.shipTypeSolidUl').width(wid1);
    
    // var myScroll2 = new IScroll('#shipScoreView', { scrollX: true, scrollY: false,preventDefault: false , mouseWheel: false ,eventPassthrough: true});
    $(".shipTypeName").css({'color':'#fff','borderBottom':'none'});
    $(".shipTypeName").eq(0).css({'color':'#00b1ff','borderBottom':'.04rem solid #00b1ff'});
    $("#shipTypeScorekuang .shipTypeScore").hide();
    $("#shipTypeScorekuang .shipTypeScore").eq(0).show();
    //通过主页成绩模块，点击级别进入总成绩页面
    showScoreDetial($.cookie('levelSailingId') || firstSaillingId);
    //级别下的成绩显示事件
    $("#shipTypeSolidUl .shipTypeSolidLi").click(function(){
        showScoreDetial($(this).attr('sailingId'));
    })
   
};
//页面初始化
$(function(){
    getSocrePage();
    document.title=saveMatchName();
});
//点击级别显示成绩的点击事件
function showScoreDetial(sailingId){
    $(".shipTypeName").css({'color':"#fff",'border':"none"}); 
    $('#sailingId'+sailingId).find("span").first().css({color:"#55ccff",borderBottom:".04rem solid #55ccff"});
    $("#shipTypeScorekuang .shipTypeScore").hide();
    $("#shipTypeScore"+sailingId).show();
}
</script>
</html>